from .libs import * 
from . import constants as gv


def center(X):
    # X: ndarray, shape (n_features, n_samples)
    scaler = StandardScaler(with_mean=True, with_std=False)
    Xc = scaler.fit_transform(X.T).T
    return Xc

def z_score(X):
    # X: ndarray, shape (n_features, n_samples)
    ss = StandardScaler(with_mean=True, with_std=True)
    Xz = ss.fit_transform(X.T).T
    return Xz

def normalize(X):
    # X: ndarray, shape (n_features, n_samples)
    Xmin = np.amin(X, axis=1)
    Xmax = np.amax(X, axis=1)
    Xmin = Xmin[:,np.newaxis]
    Xmax = Xmax[:,np.newaxis]
    return (X-Xmin)/(Xmax-Xmin+gv.eps)

def conf_inter(y):
    ci = []
    for i in range(y.shape[0]):
        ci.append( stats.t.interval(0.95, y.shape[1]-1, loc=np.mean(y[i,:]), scale=stats.sem(y[i,:])) )
    ci = np.array(ci).T

    return ci

def dFF0(X):
    F0 = np.mean(np.mean(X[:,:,gv.bins_baseline],axis=2), axis=0)
    F0 = F0[np.newaxis,:, np.newaxis] 
    return (X-F0) / (F0 + gv.eps) 
